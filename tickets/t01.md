T0.1 — Next.js 15 @edge + shadcn/ui (apps/web)

Role: Codebase Guardian for Edge/Serverless монорепо.
Non-negotiables: contracts-first, mocks-first, feature flags, disciplined migrations, tests & telemetry.

Goal

Создать приложение apps/web на Next.js 15 (App Router) с Edge-роутом /api/healthz, базовой темой Tailwind и установленным shadcn/ui (минимальный компонент Button). Всё должно собираться и запускаться локально.

Scope

In: scaffold Next 15, Tailwind, shadcn/ui, edge-роут, базовые скрипты, e2e-тест healthz.
Out: бизнес-экраны, auth, БД, observability, фичефлаги.

AC (Gherkin)
• Given я запускаю pnpm --filter @potlucky/web dev, When открываю http://localhost:3000, Then вижу страницу с текстом “Potlucky Edge OK” и кнопкой shadcn “Get Started”.
• Given я делаю GET /api/healthz, Then получаю 200 и JSON { ok: true, runtime: "edge" } с content-type: application/json.
• Given я запускаю pnpm --filter @potlucky/web build, Then проект успешно собирается без ошибок lint/typecheck.
• Given я запускаю pnpm --filter @potlucky/web test, Then тест healthz проходит (проверка формата ответа).

UX

Figma#: N/A (инфраструктурный экран-заглушка).

Contracts

OpenAPI#/ERD#: N/A (роут /api/healthz вне бизнес-контрактов).

DoD
• apps/web создан, App Router активен
• Tailwind настроен, пути content покрывают packages/\*
• shadcn/ui установлен, компонент Button доступен
• /api/healthz работает на edge runtime
• Скрипты dev/build/lint/typecheck/test в apps/web/package.json
• Vitest-тест на роут /api/healthz зелёный

⸻

Steps (выполнить по порядку)

1. Scaffold Next.js 15

pnpm dlx create-next-app@latest apps/web --ts --eslint --tailwind --app --src-dir false --import-alias @/\*

Если флаг --tailwind недоступен — установи Tailwind вручную (ниже есть файлы).

Добавь workspace-alias в корневой pnpm-workspace.yaml уже создан (T0.0). Обнови root tsconfig.base.json (он у нас есть) — ничего менять не нужно.

2. Пакетное имя и скрипты

apps/web/package.json (ключевые поля и скрипты):

{
"name": "@potlucky/web",
"private": true,
"scripts": {
"dev": "next dev -p 3000",
"build": "next build",
"start": "next start -p 3000",
"lint": "eslint . --ext .ts,.tsx",
"typecheck": "tsc --noEmit",
"test": "vitest run"
},
"dependencies": {
"next": "15.0.0",
"react": "18.3.1",
"react-dom": "18.3.1",
"clsx": "^2.1.1",
"tailwind-merge": "^2.5.2",
"class-variance-authority": "^0.7.0",
"tailwindcss-animate": "^1.0.7"
},
"devDependencies": {
"@types/node": "^20.14.10",
"autoprefixer": "^10.4.20",
"postcss": "^8.4.41",
"tailwindcss": "^3.4.10",
"vitest": "^2.0.0",
"typescript": "^5.6.0"
}
}

3. Tailwind конфиг (покрыть пакеты)

apps/web/tailwind.config.ts

import type { Config } from 'tailwindcss'

export default {
content: [
'./app/**/*.{ts,tsx}',
'./components/**/*.{ts,tsx}',
'./pages/**/*.{ts,tsx}',
'../../packages/**/*.{ts,tsx}', // shared UI
],
theme: {
extend: {},
},
plugins: [require('tailwindcss-animate')],
} satisfies Config

apps/web/postcss.config.js

module.exports = {
plugins: {
tailwindcss: {},
autoprefixer: {},
},
}

apps/web/app/globals.css

@tailwind base;
@tailwind components;
@tailwind utilities;

4. Утилита cn и shadcn Button

Создай утилиту для классов:

apps/web/lib/utils.ts

import { type ClassValue } from 'clsx'
import { clsx } from 'clsx'
import { twMerge } from 'tailwind-merge'
export function cn(...inputs: ClassValue[]) {
return twMerge(clsx(inputs))
}

Добавь базовый компонент кнопки:

apps/web/components/ui/button.tsx (совместим с shadcn/ui)

import \* as React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'
import { cn } from '@/lib/utils'

const buttonVariants = cva(
'inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2',
{
variants: {
variant: {
default: 'bg-black text-white hover:bg-black/90',
outline: 'border border-input bg-transparent hover:bg-neutral-50',
ghost: 'hover:bg-neutral-50',
},
size: {
default: 'h-10 px-4 py-2',
sm: 'h-9 rounded-md px-3',
lg: 'h-11 rounded-md px-8',
},
},
defaultVariants: { variant: 'default', size: 'default' },
}
)

export interface ButtonProps
extends React.ButtonHTMLAttributes<HTMLButtonElement>,
VariantProps<typeof buttonVariants> {
asChild?: boolean
}

export const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
({ className, variant, size, asChild = false, ...props }, ref) => {
const Comp = asChild ? Slot : 'button'
return (
<Comp
className={cn(buttonVariants({ variant, size }), className)}
ref={ref}
{...props}
/>
)
}
)
Button.displayName = 'Button'

Позже мы вынесем библиотеку компонентов в packages/ui. На T0.1 держим её внутри apps/web для скорости.

5. Базовые рендеры (layout/page)

apps/web/app/layout.tsx

import './globals.css'
import type { Metadata } from 'next'

export const metadata: Metadata = {
title: 'Potlucky',
description: 'Edge/Serverless-first scaffold',
}

export default function RootLayout({ children }: { children: React.ReactNode }) {
return (
<html lang="en">
<body className="min-h-dvh bg-white text-neutral-900 antialiased">
{children}
</body>
</html>
)
}

apps/web/app/page.tsx

import { Button } from '@/components/ui/button'

export default function HomePage() {
return (
<main className="mx-auto max-w-2xl p-8">
<h1 className="text-2xl font-semibold">Potlucky Edge OK</h1>
<p className="mt-2 text-neutral-600">
Next.js 15 + Tailwind + shadcn/ui scaffold
</p>
<div className="mt-6">
<Button>Get Started</Button>
</div>
</main>
)
}

6. Edge-роут /api/healthz

apps/web/app/api/healthz/route.ts

export const runtime = 'edge'

export async function GET() {
return new Response(JSON.stringify({ ok: true, runtime: 'edge' }), {
headers: { 'content-type': 'application/json' },
status: 200,
})
}

7. Тест для healthz (Vitest)

apps/web/tests/healthz.test.ts

import { describe, it, expect } from 'vitest'
import { GET } from '../app/api/healthz/route'

describe('healthz route', () => {
it('returns edge ok json', async () => {
const res = await GET()
expect(res.status).toBe(200)
const json = await res.json()
expect(json).toEqual({ ok: true, runtime: 'edge' })
expect(res.headers.get('content-type')).toContain('application/json')
})
})

Тест импортирует handler напрямую — быстро и надёжно для scaffold’а.

8. Lint/Typecheck интеграция

apps/web/.eslintrc.cjs

module.exports = {
extends: ['next/core-web-vitals', '../../.eslintrc.cjs'],
}

apps/web/tsconfig.json

{
"extends": "../../tsconfig.base.json",
"compilerOptions": {
"baseUrl": ".",
"paths": { "@/_": ["./_"] }
},
"include": ["app", "components", "lib", "tests", "next-env.d.ts"]
}

⸻

Команды для проверки AC

pnpm i
pnpm --filter @potlucky/web dev # открыть http://localhost:3000
pnpm --filter @potlucky/web build
pnpm --filter @potlucky/web lint
pnpm --filter @potlucky/web typecheck
pnpm --filter @potlucky/web test

Итоговое дерево (T0.1)

apps/web/
├─ app/
│ ├─ api/healthz/route.ts
│ ├─ page.tsx
│ └─ layout.tsx
├─ components/ui/button.tsx
├─ lib/utils.ts
├─ app/globals.css
├─ tailwind.config.ts
├─ postcss.config.js
├─ package.json
├─ tsconfig.json
├─ .eslintrc.cjs
└─ tests/healthz.test.ts

Рекомендованный коммит

feat(web): scaffold Next.js 15 (edge) + tailwind + shadcn; add /api/healthz and tests
